foswiki.Pref={FOSWIKI_PREF_COOKIE_NAME:"FOSWIKIPREF",COOKIE_PREF_SEPARATOR:"|",COOKIE_PREF_VALUE_SEPARATOR:"=",COOKIE_EXPIRY_TIME:365*24*60*60*1e3,setPref:function(inPrefName,inPrefValue){var cookieString=foswiki.Pref._getPrefCookie();var prefs=cookieString.split(foswiki.Pref.COOKIE_PREF_SEPARATOR);var prefName=foswiki.Pref._getSafeString(inPrefName);var index=foswiki.Pref._getKeyValueLoc(prefs,prefName);if(index!=-1){prefs.splice(index,1)}var prefValue=isNaN(inPrefValue)?foswiki.Pref._getSafeString(inPrefValue):inPrefValue;var keyvalueString=prefName+foswiki.Pref.COOKIE_PREF_VALUE_SEPARATOR+prefValue;prefs.push(keyvalueString);foswiki.Pref._writePrefValues(prefs)},clearPref:function(inPrefName){var cookieString=foswiki.Pref._getPrefCookie();var prefs=cookieString.split(foswiki.Pref.COOKIE_PREF_SEPARATOR);var prefName=foswiki.Pref._getSafeString(inPrefName);var index=foswiki.Pref._getKeyValueLoc(prefs,prefName);if(index!=-1){prefs.splice(index,1)}foswiki.Pref._writePrefValues(prefs)},getPref:function(inPrefName){var prefName=foswiki.Pref._getSafeString(inPrefName);return foswiki.Pref.getPrefValueFromPrefList(prefName,foswiki.Pref.getPrefList())},getPrefValueFromPrefList:function(inPrefName,inPrefList){var keyvalue=foswiki.Pref._getKeyValue(inPrefList,inPrefName);if(keyvalue!=null)return keyvalue[1];return""},getPrefList:function(){var cookieString=foswiki.Pref._getPrefCookie();if(!cookieString)return null;return cookieString.split(foswiki.Pref.COOKIE_PREF_SEPARATOR)},getCookie:function(inName){var arg=inName+"=";var alen=arg.length;var clen=document.cookie.length;var i=0;while(i<clen){var j=i+alen;if(document.cookie.substring(i,j)==arg){return foswiki.Pref._getCookieVal(j)}i=document.cookie.indexOf(" ",i)+1;if(i==0)break}return null},setCookie:function(inName,inValue,inExpires,inPath,inDomain,inUsesSecure){var cookieString=inName+"="+escape(inValue)+(inExpires?"; expires="+inExpires.toGMTString():"")+(inPath?"; path="+inPath:"")+(inDomain?"; domain="+inDomain:"")+(inUsesSecure?"; secure":"");document.cookie=cookieString},deleteCookie:function(inName,inPath,inDomain){if(foswiki.Pref.getCookie(inName)){document.cookie=inName+"="+(inPath?";path="+inPath:"")+(inDomain?"; domain="+inDomain:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT"}},_getKeyValue:function(inKeyValues,inKey){if(!inKeyValues)return null;var i=inKeyValues.length;while(i--){var keyvalue=inKeyValues[i].split(foswiki.Pref.COOKIE_PREF_VALUE_SEPARATOR);if(keyvalue[0]==inKey)return keyvalue}return null},_getKeyValueLoc:function(inKeyValues,inKey){if(!inKeyValues)return null;var i=inKeyValues.length;while(i--){var keyvalue=inKeyValues[i].split(foswiki.Pref.COOKIE_PREF_VALUE_SEPARATOR);if(keyvalue[0]==inKey)return i}return-1},_writePrefValues:function(inValues){var cookieString=inValues!=null?inValues.join(foswiki.Pref.COOKIE_PREF_SEPARATOR):"";var expiryDate=new Date;var cookieDomain=foswiki.getPreference("COOKIEREALM");var cookieSecure=foswiki.getPreference("URLHOST").startsWith("https://");foswiki.Pref._fixCookieDate(expiryDate);expiryDate.setTime(expiryDate.getTime()+foswiki.Pref.COOKIE_EXPIRY_TIME);foswiki.Pref.setCookie(foswiki.Pref.FOSWIKI_PREF_COOKIE_NAME,cookieString,expiryDate,"/",cookieDomain,cookieSecure)},_getPrefCookie:function(){var cookieString=foswiki.Pref.getCookie(foswiki.Pref.FOSWIKI_PREF_COOKIE_NAME);if(cookieString==undefined){cookieString=""}return cookieString},_getSafeString:function(inString){var regex=new RegExp(/[|=]/);return inString.replace(regex,"")},_getCookieVal:function(inOffset){var endstr=document.cookie.indexOf(";",inOffset);if(endstr==-1){endstr=document.cookie.length}return unescape(document.cookie.substring(inOffset,endstr))},_fixCookieDate:function(inDate){var base=new Date(0);var skew=base.getTime();if(skew>0){inDate.setTime(inDate.getTime()-skew)}}};