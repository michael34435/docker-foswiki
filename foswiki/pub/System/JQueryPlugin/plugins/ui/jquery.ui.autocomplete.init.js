jQuery(function($){var defaults={cache:true};$("input[autocomplete]:not([autocomplete=off]):not(.jqInitedAutocomplete, .jqTextboxList), .jqUIAutocomplete").livequery(function(){var $this=$(this),cache={},lastXhr,src=$this.attr("autocomplete"),opts=$.extend({source:src},defaults,$this.data(),$this.metadata());if(opts.cache&&typeof opts.source==="string"){opts._source=opts.source;opts.source=function(request,response){var term=request.term,cacheKey=term;if(typeof opts.extraParams!="undefined"){$.each(opts.extraParams,function(key,param){var val=typeof param=="function"?param($this):param;request[key]=val;cacheKey+=";"+key+"="+val})}if(cacheKey in cache){$.log("AUTOCOMPLETE: found "+term+" in cache");response(cache[cacheKey]);return}$.log("AUTOCOMPLETE: requesting '"+term+"' from "+opts._source);lastXhr=$.ajax({url:opts._source,dataType:"json",data:request,success:function(data,status,xhr){cache[cacheKey]=data;$.log("AUTOCOMPLETE: caching "+term);if(xhr===lastXhr){$.log("AUTOCOMPLETE: got data for '"+term+"' from backend");response(data)}else{$.log("AUTOCOMPLETE: throwing away results for '"+term+"'")}},error:function(xhr,status,error){alert("Error: "+status);response()}})}}$this.removeClass("jqUIAutocomplete").autocomplete(opts)})});